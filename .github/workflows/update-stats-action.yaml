name: push-stats-action
on:
  schedule:
  # - cron: "0 0 * * 1"
  - cron: "* * * * *"

# first, fetch json from stackoverflow and wakatime
# then, push the json to the repo

jobs:
  push-stats:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        persist-credentials: false
        fetch-depth: 0

    - name: Fetch waka stats
      run: |
        curl -s https://wakatime.com/share/@0269a873-ebe8-43fc-8ead-f0560fa51bae/51e6363c-2acb-4d8c-b282-835d52d97893.json > stats.json
    - name: Fetch stackoverflow reputation
      run: |
        curl -s https://stackoverflow.com/users/flair/2329060.json > stackoverflow_reputation.json
    - name: Fetch stackoverflow tags
      run: |
        curl -s https://api.stackexchange.com/2.3/users/2329060/tags?pagesize=100&order=desc&sort=popular&site=stackoverflow&filter=!bMsg5CXICfJ)0K' > stackoverflow_tags.json
    - name: Fetch ai stackexchange reputation
      run: |
        curl -s https://ai.stackexchange.com/users/flair/12841.json > ai_reputation.json
    - name: Fetch ai stackexchange tags
      run: |
        curl -s https://api.stackexchange.com/2.3/users/12841/tags?pagesize=100&order=desc&sort=popular&site=ai&filter=!bMsg5CXICfJ)0K' > ai_tags.json
    - name: Commit files
      run: |
        git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        git commit -a -m "Add changes"
    - name: Push changes
      uses: ad-m/github-push-action@master
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        branch: ${{ github.ref }}